!function(){let e=[],t=[];!async function(){try{const t="/api/tareas?url="+r(),n=await fetch(t),o=await n.json();e=o.tareas,a()}catch(e){console.log(e)}}();document.querySelector("#agregar-tarea").addEventListener("click",(function(){o(!1)}));function a(n=""){!function(){const e=document.querySelector("#listado-tareas");for(;e.firstChild;)e.removeChild(e.firstChild)}(),""==n&&function(){let a=document.querySelector('input[type="radio"]:checked');a?t=""==a.value?e:e.filter(e=>e.estado==a.value):alert("No hay ninún elemento activo")}();const c=document.querySelector("#listado-tareas");if(0==t.length){const e=document.createElement("LI");e.textContent="No hay tareas",e.classList.add("no-tareas"),c.appendChild(e)}else{const n={0:"Pendiente",1:"Completa"};t.forEach(t=>{const d=document.createElement("LI");d.dataset.tareaId=t.id,d.classList.add("tarea");const s=document.createElement("P");s.textContent=t.nombre,s.ondblclick=function(){o(!0,{...t})};const l=document.createElement("DIV");l.classList.add("opciones");const u=document.createElement("BUTTON");u.classList.add("estado-tarea"),u.classList.add(""+n[t.estado].toLowerCase()),u.textContent=n[t.estado],u.dataset.estado=t.estado,u.ondblclick=function(){!function(e){const t="0"==e.estado?"1":"0";e.estado=t,i(e)}({...t})};const m=document.createElement("BUTTON");m.classList.add("eliminar-tarea"),m.dataset.idTarea=t.id,m.textContent="Eliminar",m.ondblclick=function(){!function(t){Swal.fire({title:"¿Eliminar tarea?",showCancelButton:!0,confirmButtonText:"Sí",cancelButtonText:"No"}).then(n=>{n.isConfirmed?async function(t){const{estado:n,nombre:o,id:c,proyectoId:i}=t,d=new FormData;d.append("id",c),d.append("nombre",o),d.append("estado",n),d.append("proyectoId",i),d.append("url",r());try{const t="http://localhost:3000/api/tarea/eliminar",n=await fetch(t,{method:"POST",body:d}),o=await n.json();Swal.fire("Eliminado",o.mensaje,"success"),"exito"==o.tipo&&(e=e.filter(e=>e.id!==c),a())}catch(e){console.log(e)}}(t):Swal.fire("La tarea no se ha eliminado","","info")})}({...t})},l.appendChild(u),l.appendChild(m),d.appendChild(s),d.appendChild(l),c.appendChild(d)})}}function n(n){const o=n.target.value;t=""!==o?e.filter(e=>e.estado==o):e,a(o)}function o(t=!1,n={}){const o=document.createElement("DIV");o.classList.add("modal");const d=document.createElement("FORM");d.classList.add("formulario"),d.classList.add("nueva-tarea"),d.innerHTML=`\n                <legend>${t?"Editar Tarea":"Añade una nueva tarea"}</legend>\n                <div class="campo">\n                    <label for="">Tarea: </label>\n                    <input \n                        type="text" \n                        name="tarea" \n                        placeholder="${n.nombre?"Edita la tarea":"Añadir tarea al proyecto"}" \n                        id="tarea"\n                        value="${n.nombre?n.nombre:""}"\n                    >\n                </div>\n                <div class="opciones">\n                    <input \n                        type="submit" \n                        class="submit-nueva-tarea" \n                        value="${n.nombre?"Guardar cambios":"Añadir Tarea"}" \n                    >\n                    <button type="button" class="cerrar-modal">Cancelar</button>\n                </div>      \n        `,setTimeout(()=>{d.classList.add("animar")},0),o.appendChild(d),o.addEventListener("click",(function(s){if(s.preventDefault(),s.target.classList.contains("cerrar-modal")&&(d.classList.add("cerrar"),setTimeout(()=>{o.remove()},500)),s.target.classList.contains("submit-nueva-tarea")){const o=document.querySelector("#tarea").value.trim();if(""==o)return void c("El nombre de la tarea es obligatorio","error",document.querySelector(".formulario legend"));t?(n.nombre=o,i(n)):async function(t){const n=new FormData;n.append("nombre",t),n.append("url",r());try{const o="http://localhost:3000/api/tarea",r=await fetch(o,{method:"POST",body:n}),i=await r.json();if(c(i.mensaje,i.tipo,document.querySelector(".formulario legend")),"exito"==i.tipo){const n=document.querySelector(".modal");setTimeout(()=>{n.remove();const o={id:String(i.id),nombre:t,estado:0,proyectoId:i.proyectoId};e=[...e,o],a()},1500)}}catch(e){console.log(e)}}(o)}})),document.querySelector(".dashboard").appendChild(o)}function r(){const e=new URLSearchParams(window.location.search);return Object.fromEntries(e.entries()).url}function c(e,t,a){const n=document.querySelector(".alerta");n&&n.remove();const o=document.createElement("DIV");o.classList.add("alerta",t),o.textContent=e,a.parentElement.insertBefore(o,a.nextElementSibling),setTimeout(()=>{o.remove()},1500)}async function i(t){const{estado:n,nombre:o,id:c,proyectoId:i}=t,d=new FormData;d.append("id",c),d.append("nombre",o),d.append("estado",n),d.append("proyectoId",i),d.append("url",r());try{const t="http://localhost:3000/api/tarea/actualizar",r=await fetch(t,{method:"POST",body:d}),i=await r.json();swal.fire(i.mensaje,"","exito"==i.tipo?"success":"error");const s=document.querySelector(".modal");s&&s.remove(),"exito"==i.tipo&&(e=e.map(e=>(e.id==c&&(e.estado=n,e.nombre=o),e)),a())}catch(e){console.log(e)}}document.querySelectorAll('#filtros input[type="radio"]').forEach(e=>{e.addEventListener("input",n)})}();